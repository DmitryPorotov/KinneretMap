<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" ng-app="mapApp">
<head>
  <title>Kinneret College Map</title>
  <link href="css/map.css" rel="stylesheet" />
  <link href="css/ol.css" rel="stylesheet" />

  <script src="js/lib/underscore-min.js"></script>
  <!--angular.js lib-->
  <script src="js/lib/angular/angular.js"></script>
  <script src="js/lib/angular/angular-route.js"></script>
  <!--angular.js lib END-->
  <script src="js/app.js"></script>
  <script src="js/services/dataService.js"></script>
  <script src="js/controllers/menuController.js"></script>
  <script src="js/directives/searchDirective.js"></script>
  <script src="js/directives/catalogDirective.js"></script>


  <script src="js/geoJsonData.js"></script>
  <script src="js/lib/ol-debug.js"></script>
</head>
<body>
  <div id="map" class="map"></div>
  <div id="menu-bar" ng-controller="menuController">
    <div class="search-bar">
      <button type="button" class="search-button buttons" ng-click="search()"></button>
      <input type="text" class="search-field" ng-model="searchField"/>
      <button type="button" class="buildings-button buttons" ng-click="showBuildingsCatalog()"></button>
      <button type="button" class="staff-button buttons"></button>
    </div>
    <div class="catalog-box" ng-class="setResultsClass()" ng-hide="!(isSearchShown || isBuildingsCatalogShown || isStaffCatalogShown)">
      <div class="arrow-up"></div>
      <km-search search-results="searchResults" ng-show="isSearchShown"></km-search>
      <km-catalog ng-show="isBuildingsCatalogShown"></km-catalog>
    </div>
    <div class="room-details" ng-hide="!isRoomDetailsShown">

    </div>
    <div class="floor-plan" ng-hide="!isFloorPlanShown">

    </div>
  </div>
  <script type="text/javascript">
    var styles = {
      'Polygon': [new ol.style.Style({
        stroke: new ol.style.Stroke({
          color: 'blue',
          width: 3
        }),
        fill: new ol.style.Fill({
          color: 'rgba(0, 0, 255, 0.1)'
        })
      })]
    };

    var styleFunction = function (feature, resolution) {
      return styles[feature.getGeometry().getType()];
    };

    var vectorSource = new ol.source.GeoJSON(geoJsonData);

    var vectorLayer = new ol.layer.Vector({
      source: vectorSource,
      style: styleFunction
    });

    var map = new ol.Map({
      target: 'map',
      layers: [
        new ol.layer.Tile({
          source: new ol.source.OSM()
        }),
        vectorLayer
      ],
      view: new ol.View({
        center: ol.proj.transform([35.5919148, 32.7053342], 'EPSG:4326', 'EPSG:3857'),
        zoom: 19
      })
    });

    map.on("click", function (e) {
      map.forEachFeatureAtPixel(e.pixel, function (feature, layer) {
        debugger;
      })
    });
  </script>
</body>
</html>